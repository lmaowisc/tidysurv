<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.39">

  <meta name="author" content="Lu Mao">
  <title>Tidy Survival Analysis --- A Workshop – Tidy Survival Analysis: Applying R’s Tidyverse to Survival Data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-423d414d36ce366a9d05f36d06304417.css">
  <link rel="stylesheet" href="style.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <style type="text/css">
  ul li ul li {
    font-size: 0.78em;
  }
  </style>
<meta name="twitter:title" content="Tidy Survival Analysis: Applying R’s Tidyverse to Survival Data – Tidy Survival Analysis — A Workshop">
<meta name="twitter:description" content="Module 4. Semiparametric Regression Analysis">
<meta name="twitter:card" content="summary">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Tidy Survival Analysis: Applying R’s Tidyverse to Survival Data</h1>
  <p class="subtitle">Module 4. Semiparametric Regression Analysis</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Lu Mao 
</div>
<div class="quarto-title-author-email">
<a href="mailto:lmao@biostat.wisc.edu">lmao@biostat.wisc.edu</a>
</div>
        <p class="quarto-title-affiliation">
            Department of Biostatistics &amp; Medical Informatics
          </p>
        <p class="quarto-title-affiliation">
            University of Wisconsin-Madison
          </p>
        <p class="quarto-title-affiliation">
            Aug 2, 2025
          </p>
    </div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/presenting-regression-results" id="/toc-presenting-regression-results">Presenting Regression Results</a></li>
<li><a href="#/cox-model-prediction-and-diagnostics" id="/toc-cox-model-prediction-and-diagnostics">Cox Model Prediction and Diagnostics</a></li>
<li><a href="#/competing-risks-regression" id="/toc-competing-risks-regression">Competing Risks Regression</a></li>
<li><a href="#/summary" id="/toc-summary">Summary</a></li>
</ul>
</nav>
</section>
<section>
<section id="presenting-regression-results" class="title-slide slide level1 center">
<h1>Presenting Regression Results</h1>

</section>
<section id="cox-ph-regression" class="slide level2">
<h2>Cox PH Regression</h2>
<ul>
<li><strong>Model specification</strong> <span class="math display">\[
  \lambda(t \mid Z) = \lambda_0(t) \exp(\beta_1 Z_1 + \beta_2 Z_2 + \ldots + \beta_p Z_p)
  \]</span>
<ul>
<li><span class="math inline">\(\lambda_0(t)\)</span>: baseline hazard function</li>
<li><span class="math inline">\(\exp(\beta_j)\)</span>: hazard ratio for covariate <span class="math inline">\(Z_j\)</span></li>
</ul></li>
<li><strong>GBC data: relapse-free survival</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(tidyverse) <span class="co"># Load tidyverse packages</span></span>
<span id="cb1-2"><a></a>gbc <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/gbc.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>) <span class="co"># Load GBC dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gbc-data-a-running-example" class="slide level2">
<h2>GBC Data: a Running Example</h2>
<ul>
<li><strong>Reformat the data</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>df <span class="ot">&lt;-</span> gbc <span class="sc">|&gt;</span>  <span class="co"># calculate time to first event (relapse or death)</span></span>
<span id="cb2-2"><a></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span> <span class="co"># group by id</span></span>
<span id="cb2-3"><a></a>  <span class="fu">arrange</span>(time) <span class="sc">|&gt;</span> <span class="co"># sort rows by time</span></span>
<span id="cb2-4"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span>      <span class="co"># get the first row within each id</span></span>
<span id="cb2-5"><a></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span>     <span class="co"># remove grouping</span></span>
<span id="cb2-6"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-7"><a></a>    <span class="at">age40 =</span> <span class="fu">ifelse</span>(age <span class="sc">&gt;=</span> <span class="dv">40</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># create binary variable for age &gt;= 40</span></span>
<span id="cb2-8"><a></a>    <span class="at">grade =</span> <span class="fu">factor</span>(grade), <span class="co"># convert grade to factor</span></span>
<span id="cb2-9"><a></a>    <span class="at">prog =</span> prog <span class="sc">/</span> <span class="dv">100</span>, <span class="co"># rescale progesterone receptor</span></span>
<span id="cb2-10"><a></a>    <span class="at">estrg =</span> estrg <span class="sc">/</span> <span class="dv">100</span> <span class="co"># rescale estrogen receptor</span></span>
<span id="cb2-11"><a></a>    ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analysis-in-base-r" class="slide level2">
<h2>Analysis in Base R</h2>
<ul>
<li><strong>Model fitting</strong>: <code>survival::coxph()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="fu">library</span>(survival) <span class="co"># Load survival package</span></span>
<span id="cb3-2"><a></a>cox_fit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> hormone <span class="sc">+</span> meno <span class="sc">+</span> age40 <span class="sc">+</span> grade <span class="sc">+</span> size <span class="sc">+</span> prog <span class="sc">+</span> estrg, </span>
<span id="cb3-3"><a></a>                 <span class="at">data =</span> df)</span>
<span id="cb3-4"><a></a><span class="fu">summary</span>(cox_fit) <span class="co"># Print model summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(time, status) ~ hormone + meno + age40 + 
    grade + size + prog + estrg, data = df)

  n= 686, number of events= 299 

            coef exp(coef) se(coef)      z Pr(&gt;|z|)    
hormone -0.37432   0.68776  0.12917 -2.898 0.003758 ** 
meno     0.28450   1.32909  0.13973  2.036 0.041748 *  
age40   -0.55127   0.57622  0.20243 -2.723 0.006463 ** 
grade2   0.71547   2.04514  0.24854  2.879 0.003993 ** 
grade3   0.77465   2.16982  0.26970  2.872 0.004075 ** 
size     0.01606   1.01619  0.00368  4.365 1.27e-05 ***
prog    -0.22400   0.79932  0.05776 -3.878 0.000105 ***
estrg    0.01204   1.01212  0.04680  0.257 0.796895    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
hormone    0.6878     1.4540    0.5339    0.8859
meno       1.3291     0.7524    1.0107    1.7478
age40      0.5762     1.7355    0.3875    0.8568
grade2     2.0451     0.4890    1.2565    3.3287
grade3     2.1698     0.4609    1.2790    3.6812
size       1.0162     0.9841    1.0089    1.0236
prog       0.7993     1.2511    0.7138    0.8951
estrg      1.0121     0.9880    0.9234    1.1093

Concordance= 0.661  (se = 0.016 )
Likelihood ratio test= 78.79  on 8 df,   p=9e-14
Wald test            = 68.82  on 8 df,   p=8e-12
Score (logrank) test = 69.51  on 8 df,   p=6e-12</code></pre>
</div>
</div>
</section>
<section id="tidy-coxph-output" class="slide level2">
<h2>Tidy <code>coxph()</code> Output</h2>
<ul>
<li><strong>Using <code>broom</code> package</strong>: <code>broom::tidy()</code>
<ul>
<li>Provides a tidy data frame for easy manipulation and visualization</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">library</span>(broom) <span class="co"># Load broom package</span></span>
<span id="cb5-2"><a></a>tidy_cox <span class="ot">&lt;-</span> <span class="fu">tidy</span>(cox_fit) <span class="co"># Tidy the coxph output</span></span>
<span id="cb5-3"><a></a>tidy_cox <span class="co"># Display the tidy output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  term    estimate std.error statistic   p.value
  &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 hormone  -0.374    0.129      -2.90  0.00376  
2 meno      0.284    0.140       2.04  0.0417   
3 age40    -0.551    0.202      -2.72  0.00646  
4 grade2    0.715    0.249       2.88  0.00399  
5 grade3    0.775    0.270       2.87  0.00408  
6 size      0.0161   0.00368     4.37  0.0000127
7 prog     -0.224    0.0578     -3.88  0.000105 
8 estrg     0.0120   0.0468      0.257 0.797    </code></pre>
</div>
</div>
</section>
<section id="tabulating-results-with-gtsummary-i" class="slide level2">
<h2>Tabulating Results with <code>gtsummary</code> (I)</h2>
<ul>
<li><strong>Using <code>gtsummary</code> package</strong>: <code>tbl_regression()</code>
<ul>
<li>Automatically formats regression results into a publication-ready table</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="fu">library</span>(gtsummary) <span class="co"># Load gtsummary package</span></span>
<span id="cb7-2"><a></a>cox_tbl <span class="ot">&lt;-</span> cox_fit <span class="sc">|&gt;</span> <span class="fu">tbl_regression</span>( <span class="co"># Create a regression table</span></span>
<span id="cb7-3"><a></a>                <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="co"># Exponentiate coefficients to get hazard ratios</span></span>
<span id="cb7-4"><a></a>                <span class="at">label =</span> <span class="fu">list</span>(hormone <span class="sc">~</span> <span class="st">"Hormone Therapy"</span>, <span class="co"># Custom labels</span></span>
<span id="cb7-5"><a></a>                             meno <span class="sc">~</span> <span class="st">"Menopausal"</span>, </span>
<span id="cb7-6"><a></a>                             age40 <span class="sc">~</span> <span class="st">"Older than 40"</span>, </span>
<span id="cb7-7"><a></a>                             grade <span class="sc">~</span> <span class="st">"Tumor Grade"</span>, </span>
<span id="cb7-8"><a></a>                             size <span class="sc">~</span> <span class="st">"Tumor Size (mm)"</span>, </span>
<span id="cb7-9"><a></a>                             prog <span class="sc">~</span> <span class="st">"Progesterone Receptor (100 fmol/ml)"</span>, </span>
<span id="cb7-10"><a></a>                             estrg <span class="sc">~</span> <span class="st">"Estrogen Receptor  (100 fmol/ml)"</span>)</span>
<span id="cb7-11"><a></a>               ) <span class="sc">|&gt;</span> </span>
<span id="cb7-12"><a></a>          <span class="fu">add_global_p</span>() <span class="co"># Add global p-value for categorical variables</span></span>
<span id="cb7-13"><a></a>cox_tbl <span class="co"># Display the regression table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tabulating-results-with-gtsummary-ii" class="slide level2">
<h2>Tabulating Results with <code>gtsummary</code> (II)</h2>
<ul>
<li><strong>Result</strong></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="hjiuxkxhpu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hjiuxkxhpu table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hjiuxkxhpu thead, #hjiuxkxhpu tbody, #hjiuxkxhpu tfoot, #hjiuxkxhpu tr, #hjiuxkxhpu td, #hjiuxkxhpu th {
  border-style: none;
}

#hjiuxkxhpu p {
  margin: 0;
  padding: 0;
}

#hjiuxkxhpu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hjiuxkxhpu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hjiuxkxhpu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hjiuxkxhpu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hjiuxkxhpu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hjiuxkxhpu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hjiuxkxhpu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hjiuxkxhpu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hjiuxkxhpu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hjiuxkxhpu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hjiuxkxhpu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hjiuxkxhpu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hjiuxkxhpu .gt_spanner_row {
  border-bottom-style: hidden;
}

#hjiuxkxhpu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hjiuxkxhpu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hjiuxkxhpu .gt_from_md > :first-child {
  margin-top: 0;
}

#hjiuxkxhpu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hjiuxkxhpu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hjiuxkxhpu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hjiuxkxhpu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hjiuxkxhpu .gt_row_group_first td {
  border-top-width: 2px;
}

#hjiuxkxhpu .gt_row_group_first th {
  border-top-width: 2px;
}

#hjiuxkxhpu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hjiuxkxhpu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hjiuxkxhpu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hjiuxkxhpu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hjiuxkxhpu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hjiuxkxhpu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hjiuxkxhpu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hjiuxkxhpu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hjiuxkxhpu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hjiuxkxhpu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hjiuxkxhpu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hjiuxkxhpu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hjiuxkxhpu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hjiuxkxhpu .gt_left {
  text-align: left;
}

#hjiuxkxhpu .gt_center {
  text-align: center;
}

#hjiuxkxhpu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hjiuxkxhpu .gt_font_normal {
  font-weight: normal;
}

#hjiuxkxhpu .gt_font_bold {
  font-weight: bold;
}

#hjiuxkxhpu .gt_font_italic {
  font-style: italic;
}

#hjiuxkxhpu .gt_super {
  font-size: 65%;
}

#hjiuxkxhpu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hjiuxkxhpu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hjiuxkxhpu .gt_indent_1 {
  text-indent: 5px;
}

#hjiuxkxhpu .gt_indent_2 {
  text-indent: 10px;
}

#hjiuxkxhpu .gt_indent_3 {
  text-indent: 15px;
}

#hjiuxkxhpu .gt_indent_4 {
  text-indent: 20px;
}

#hjiuxkxhpu .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="<strong>Characteristic</strong>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="<strong>HR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>HR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="<strong>p-value</strong>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">Hormone Therapy</td>
<td class="gt_row gt_center" headers="estimate">0.69</td>
<td class="gt_row gt_center" headers="ci">0.53, 0.89</td>
<td class="gt_row gt_center" headers="p.value">0.003</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Menopausal</td>
<td class="gt_row gt_center" headers="estimate">1.33</td>
<td class="gt_row gt_center" headers="ci">1.01, 1.75</td>
<td class="gt_row gt_center" headers="p.value">0.039</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Older than 40</td>
<td class="gt_row gt_center" headers="estimate">0.58</td>
<td class="gt_row gt_center" headers="ci">0.39, 0.86</td>
<td class="gt_row gt_center" headers="p.value">0.009</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Tumor Grade</td>
<td class="gt_row gt_center" headers="estimate"><br>
</td>
<td class="gt_row gt_center" headers="ci"><br>
</td>
<td class="gt_row gt_center" headers="p.value">0.004</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;1</td>
<td class="gt_row gt_center" headers="estimate">—</td>
<td class="gt_row gt_center" headers="ci">—</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;2</td>
<td class="gt_row gt_center" headers="estimate">2.05</td>
<td class="gt_row gt_center" headers="ci">1.26, 3.33</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;3</td>
<td class="gt_row gt_center" headers="estimate">2.17</td>
<td class="gt_row gt_center" headers="ci">1.28, 3.68</td>
<td class="gt_row gt_center" headers="p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Tumor Size (mm)</td>
<td class="gt_row gt_center" headers="estimate">1.02</td>
<td class="gt_row gt_center" headers="ci">1.01, 1.02</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">Progesterone Receptor (100 fmol/ml)</td>
<td class="gt_row gt_center" headers="estimate">0.80</td>
<td class="gt_row gt_center" headers="ci">0.71, 0.90</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Estrogen Receptor (100 fmol/ml)</td>
<td class="gt_row gt_center" headers="estimate">1.01</td>
<td class="gt_row gt_center" headers="ci">0.92, 1.11</td>
<td class="gt_row gt_center" headers="p.value">0.8</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> HR = Hazard Ratio, CI = Confidence Interval</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</section>
<section id="further-customization" class="slide level2">
<h2>Further Customization</h2>
<!-- modify_header()    update column headers -->
<!-- modify_footnote_header()   update column header footnote -->
<!-- modify_footnote_body()     update table body footnote -->
<!-- modify_spanning_header()   update spanning headers -->
<!-- modify_caption()   update table caption/title -->
<!-- bold_labels()  bold variable labels -->
<!-- bold_levels()  bold variable levels -->
<!-- italicize_labels()     italicize variable labels -->
<!-- italicize_levels()     italicize variable levels -->
<!-- bold_p()   bold significant p-values -->
<ul>
<li><strong>Styling functions</strong>
<ul>
<li><code>modify_header()</code>: update column headers</li>
<li><code>modify_footnote_header()</code>: update column header footnote</li>
<li><code>modify_footnote_body()</code>: update table body footnote</li>
<li><code>modify_caption()</code>: update table caption/title</li>
<li><code>bold_labels()</code>: bold variable labels</li>
<li><code>bold_levels()</code>: bold variable levels</li>
<li><code>italicize_labels()</code>: italicize variable labels</li>
<li><code>italicize_levels()</code>: italicize variable levels</li>
<li><code>bold_p()</code>: bold significant p-values</li>
</ul></li>
<li>More about <code>tbl_regression()</code>
<ul>
<li><a href="https://www.danieldsjoberg.com/gtsummary/articles/tbl_regression.html"><code>gtsummary</code> documentation</a></li>
</ul></li>
</ul>
</section>
<section id="table-customization-exercise" class="slide level2">
<h2>Table Customization Exercise</h2>
<ul>
<li><strong>Task</strong>: Customize the regression table
<ul>
<li>Add a caption: “Cox regression analysis of the German breast cancer study”</li>
<li>Bold significant p-values</li>
<li>Italicize tumor grade levels</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>cox_tbl <span class="sc">|&gt;</span> <span class="co"># Start with the regression table</span></span>
<span id="cb8-2"><a></a>  <span class="fu">modify_caption</span>(<span class="st">"Cox regression analysis of the German breast cancer study"</span>) <span class="sc">|&gt;</span> <span class="co"># Add caption</span></span>
<span id="cb8-3"><a></a>  <span class="fu">bold_p</span>() <span class="sc">|&gt;</span> <span class="co"># Bold significant p-values</span></span>
<span id="cb8-4"><a></a>  <span class="fu">italicize_levels</span>() <span class="co"># Italicize variable levels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="other-regression-models" class="slide level2">
<h2>Other Regression Models</h2>
<ul>
<li><strong>Accelerated failure time (AFT) models</strong> <span class="math display">\[
  \log T = \beta_0 + \beta_1 Z_1 + \beta_2 Z_2 + \ldots + \beta_p Z_p + \epsilon
\]</span>
<ul>
<li><span class="math inline">\(\epsilon\sim\)</span> Weibull, lognormal, etc. (parametric models)</li>
<li><span class="math inline">\(\exp(\beta_j)\)</span>: acceleration factor for covariate <span class="math inline">\(Z_j\)</span></li>
<li><strong>Model fitting</strong>: <code>survival::survreg()</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="co"># Fit a Weibull AFT model</span></span>
<span id="cb9-2"><a></a>aft_fit <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> hormone <span class="sc">+</span> meno <span class="sc">+</span> age <span class="sc">+</span> grade <span class="sc">+</span> size <span class="sc">+</span> prog <span class="sc">+</span> estrg, </span>
<span id="cb9-3"><a></a>                    <span class="at">data =</span> df, <span class="at">dist =</span> <span class="st">"weibull"</span>) <span class="co"># specify the Weibull model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-note no-icon callout-titled callout-style-simple">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercise</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Tidy up the <code>survreg</code> object <code>aft_fit</code> using <code>broom::tidy()</code></li>
<li>Create a regression table using <code>gtsummary::tbl_regression()</code></li>
</ul>
</div>
</div>
</div>
</section>
<section id="visualizing-hazard-ratios-i" class="slide level2">
<h2>Visualizing Hazard Ratios (I)</h2>
<ul>
<li><strong>Forest plot</strong>: Visualize hazard ratios and confidence intervals</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="co"># Tidy with exponentiated coeffs (HR) and CI</span></span>
<span id="cb10-2"><a></a>tidy_cox <span class="ot">&lt;-</span> <span class="fu">tidy</span>(cox_fit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) </span>
<span id="cb10-3"><a></a>tidy_cox<span class="sc">$</span>term <span class="ot">&lt;-</span> <span class="fu">recode</span>(tidy_cox<span class="sc">$</span>term,           <span class="co"># Relabel the variables</span></span>
<span id="cb10-4"><a></a>                <span class="at">hormone =</span> <span class="st">"Hormone Therapy"</span>, </span>
<span id="cb10-5"><a></a>                <span class="at">meno =</span> <span class="st">"Menopausal"</span>, </span>
<span id="cb10-6"><a></a>                <span class="at">age40 =</span> <span class="st">"Older than 40"</span>, </span>
<span id="cb10-7"><a></a>                <span class="at">grade2 =</span> <span class="st">"Tumor Grade II vs I"</span>,</span>
<span id="cb10-8"><a></a>                <span class="at">grade3 =</span> <span class="st">"Tumor Grade III vs I"</span>,</span>
<span id="cb10-9"><a></a>                <span class="at">size =</span> <span class="st">"Tumor Size (mm)"</span>, </span>
<span id="cb10-10"><a></a>                <span class="at">prog =</span> <span class="st">"Progesterone (100 fmol/ml)"</span>, </span>
<span id="cb10-11"><a></a>                <span class="at">estrg =</span> <span class="st">"Estrogen (100 fmol/ml)"</span>)</span>
<span id="cb10-12"><a></a></span>
<span id="cb10-13"><a></a>tidy_cox <span class="sc">|&gt;</span>  <span class="co"># plot of hazard ratios and 95% CIs</span></span>
<span id="cb10-14"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>term, <span class="at">x=</span>estimate, <span class="at">xmin=</span>conf.low, <span class="at">xmax=</span>conf.high)) <span class="sc">+</span> </span>
<span id="cb10-15"><a></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span>  <span class="co"># plots center point (x) and range (xmin, xmax)</span></span>
<span id="cb10-16"><a></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co"># vertical line at HR=1</span></span>
<span id="cb10-17"><a></a>  <span class="fu">scale_x_log10</span>(<span class="st">"Hazard ratio (95% CI)"</span>) <span class="sc">+</span> <span class="co"># log scale for x-axis</span></span>
<span id="cb10-18"><a></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="co"># classic theme for clean look</span></span>
<span id="cb10-19"><a></a>  <span class="fu">theme</span>(</span>
<span id="cb10-20"><a></a>    <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),          <span class="co"># remove y-axis line</span></span>
<span id="cb10-21"><a></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),         <span class="co"># remove y-axis ticks</span></span>
<span id="cb10-22"><a></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),  <span class="co"># set variable label size</span></span>
<span id="cb10-23"><a></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()          <span class="co"># remove y-axis title</span></span>
<span id="cb10-24"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-hazard-ratios-ii" class="slide level2">
<h2>Visualizing Hazard Ratios (II)</h2>
<ul>
<li><strong>Result</strong></li>
</ul>

<img data-src="sec4_files/figure-revealjs/unnamed-chunk-10-1.png" width="960" class="r-stretch"></section>
<section id="forest-plot-exercise" class="slide level2">
<h2>Forest Plot Exercise</h2>
<ul>
<li><strong>Task</strong>: customize the forest plot
<ul>
<li>Use square rather than default circle for point estimates</li>
<li>Set x-axis ticks at 0.5, 1, 2.0, and 4.0</li>
<li>Add a title: “Cox Regression Results for GBC Data”</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>tidy_cox <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>term, <span class="at">x=</span>estimate, <span class="at">xmin=</span>conf.low, <span class="at">xmax=</span>conf.high)) <span class="sc">+</span> </span>
<span id="cb11-3"><a></a>  <span class="fu">geom_pointrange</span>(<span class="at">shape =</span> <span class="dv">15</span>) <span class="sc">+</span>  <span class="co"># plots center point (x) in square and range (xmin, xmax)</span></span>
<span id="cb11-4"><a></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co"># vertical line at HR=1</span></span>
<span id="cb11-5"><a></a>  <span class="fu">scale_x_log10</span>(<span class="st">"Hazard ratio (95% CI)"</span>,    <span class="co"># log scale for x-axis</span></span>
<span id="cb11-6"><a></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="sc">+</span> <span class="co"># log scale for x-axis</span></span>
<span id="cb11-7"><a></a>  <span class="fu">ggtitle</span>(<span class="st">"Cox Regression Results for GBC Data"</span>) <span class="sc">+</span> <span class="co"># Add title</span></span>
<span id="cb11-8"><a></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="co"># classic theme for clean look</span></span>
<span id="cb11-9"><a></a>  <span class="fu">theme</span>(</span>
<span id="cb11-10"><a></a>    <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),          <span class="co"># remove y-axis line</span></span>
<span id="cb11-11"><a></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),         <span class="co"># remove y-axis ticks</span></span>
<span id="cb11-12"><a></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),  <span class="co"># set variable label size</span></span>
<span id="cb11-13"><a></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()          <span class="co"># remove y-axis title</span></span>
<span id="cb11-14"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section>
<section>
<section id="cox-model-prediction-and-diagnostics" class="title-slide slide level1 center">
<h1>Cox Model Prediction and Diagnostics</h1>

</section>
<section id="model-based-prediction" class="slide level2">
<h2>Model-Based Prediction</h2>
<ul>
<li><p><strong>Predicted survival function</strong> <span class="math display">\[
\hat S(t \mid z) = \exp\left\{- \exp(\hat\beta^\mathrm{T} z) \hat\Lambda_0(t)\right\}
\]</span></p></li>
<li><p>Prepare new data for prediction</p>
<ul>
<li>A post-menpausal woman older than 40, undergoing hormone therapy, with tumor grade II, tumor size 20 mm, and progesterone and estrogen receptor levels both 100 fmol/ml.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="co"># Create new data for prediction</span></span>
<span id="cb12-2"><a></a><span class="co"># specify all covariate values</span></span>
<span id="cb12-3"><a></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">hormone =</span> <span class="dv">2</span>, <span class="at">meno =</span> <span class="dv">2</span>, <span class="at">age40 =</span> <span class="dv">1</span>, <span class="at">grade =</span> <span class="fu">factor</span>(<span class="dv">2</span>), </span>
<span id="cb12-4"><a></a>                        <span class="at">size =</span> <span class="dv">20</span>, <span class="at">prog =</span> <span class="dv">1</span>, <span class="at">estrg =</span> <span class="dv">1</span>)</span>
<span id="cb12-5"><a></a></span>
<span id="cb12-6"><a></a>new_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  hormone meno age40 grade size prog estrg
1       2    2     1     2   20    1     1</code></pre>
</div>
</div>
</section>
<section id="tidy-survival-prediction" class="slide level2">
<h2>Tidy Survival Prediction</h2>
<ul>
<li>Use <code>survival::survfit()</code> to predict survival probabilities
<ul>
<li><code>newdata</code>: new data for prediction</li>
<li><code>times</code>: time points for prediction</li>
<li><code>broom::tidy()</code> to tidy the output</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="co"># Predict survival probabilities for `newdata`</span></span>
<span id="cb14-2"><a></a>pred_surv <span class="ot">&lt;-</span> <span class="fu">survfit</span>(cox_fit, <span class="at">newdata =</span> new_data[<span class="dv">1</span>, ])</span>
<span id="cb14-3"><a></a>tidy_pred_surv <span class="ot">&lt;-</span> <span class="fu">tidy</span>(pred_surv) <span class="co"># Tidy the survival prediction output</span></span>
<span id="cb14-4"><a></a><span class="fu">head</span>(tidy_pred_surv) <span class="co"># Display the first few rows of the tidy output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
   time n.risk n.event n.censor estimate std.error conf.high conf.low
  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 0.262    686       0        1        1         0         1        1
2 0.492    685       0        1        1         0         1        1
3 0.525    684       0        1        1         0         1        1
4 0.557    683       0        2        1         0         1        1
5 0.590    681       0        1        1         0         1        1
6 0.951    680       0        1        1         0         1        1</code></pre>
</div>
</div>
</section>
<section id="visualizing-predicted-survival-i" class="slide level2">
<h2>Visualizing Predicted Survival (I)</h2>
<ul>
<li><strong>Using <code>ggsurvfit</code> package</strong>: <code>ggsurvfit()</code>
<ul>
<li>Pass <code>survfit</code> object to <code>ggsurvfit()</code></li>
<li>Similar customization to KM curves</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="fu">library</span>(ggsurvfit) <span class="co"># Load ggsurvfit package</span></span>
<span id="cb16-2"><a></a>pred_fig <span class="ot">&lt;-</span> pred_surv <span class="sc">|&gt;</span>  <span class="co"># Pass the survfit object</span></span>
<span id="cb16-3"><a></a>  <span class="fu">ggsurvfit</span>() <span class="sc">+</span> <span class="co"># Main function</span></span>
<span id="cb16-4"><a></a>  <span class="fu">add_confidence_interval</span>() <span class="sc">+</span> <span class="co"># Add confidence interval</span></span>
<span id="cb16-5"><a></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Time (months)"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">84</span>, <span class="at">by =</span> <span class="dv">12</span>)) <span class="sc">+</span> <span class="co"># x-axis format</span></span>
<span id="cb16-6"><a></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Relapse-free survival probability"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># y-axis format</span></span>
<span id="cb16-7"><a></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicted Relapse-Free Survival for a GBC Patient"</span>) <span class="sc">+</span> <span class="co"># Add title</span></span>
<span id="cb16-8"><a></a>  <span class="fu">theme_classic</span>() <span class="co"># Classic theme for clean look</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-predicted-survival-ii" class="slide level2">
<h2>Visualizing Predicted Survival (II)</h2>
<ul>
<li><strong>Result</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>pred_fig <span class="co"># print figure</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="sec4_files/figure-revealjs/unnamed-chunk-15-1.png" width="672" class="r-stretch"></section>
<section id="prediction-graphics-exercise" class="slide level2">
<h2>Prediction Graphics Exercise</h2>
<ul>
<li><strong>Task</strong>: Add horizontal grid lines</li>
</ul>

<img data-src="sec4_files/figure-revealjs/unnamed-chunk-16-1.png" width="672" class="r-stretch"><div class="cell">
<details class="code-fold">
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>pred_fig <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>()) <span class="co"># Add horizontal grid lines</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cox-model-diagnostics" class="slide level2">
<h2>Cox Model Diagnostics</h2>
<ul>
<li><strong>Ph assumptions: Schoenfeld residuals</strong>
<ul>
<li>Difference between observed and expected covariate values at each event time</li>
<li>Use <code>cox.zph()</code> to test PH assumption</li>
<li>Use <code>survminer::ggcoxzph()</code> on <code>cox.zph</code> object to visualize Schoenfeld residuals</li>
</ul></li>
<li><strong>Functional form of covariates</strong>
<ul>
<li>Plot martingale residuals against (quantitative) covariates</li>
<li>Use <code>residuals(cox_fit, type = "martingale")</code> to get martingale residuals`</li>
</ul></li>
<li><strong>Other aspects</strong>
<ul>
<li>Appropriateness of exponential link function</li>
<li>Influential points/outliers</li>
<li><code>survminer::ggcoxdiagnostics()</code></li>
</ul></li>
</ul>
</section>
<section id="schoenfeld-residuals" class="slide level2">
<h2>Schoenfeld Residuals</h2>
<ul>
<li><strong>Check proportionality</strong>
<ul>
<li>Focus on graphics; use <span class="math inline">\(p\)</span>-value only as guideline</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a><span class="fu">library</span>(survminer) <span class="co"># Load survminer package</span></span>
<span id="cb19-2"><a></a>ph_test <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(cox_fit) <span class="co"># Test proportional hazards assumption</span></span>
<span id="cb19-3"><a></a><span class="fu">ggcoxzph</span>(ph_test) <span class="co"># Visualize Schoenfeld residuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="sec4_files/figure-revealjs/unnamed-chunk-18-1.png" width="960" class="r-stretch"></section>
<section id="exponential-link-function" class="slide level2">
<h2>Exponential Link Function</h2>
<ul>
<li><strong>Martingale vs.&nbsp;<span class="math inline">\(\hat\beta^\mathrm{T} Z_i\)</span></strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a><span class="co"># Martingale residuals vs linear predictor</span></span>
<span id="cb20-2"><a></a><span class="fu">ggcoxdiagnostics</span>(cox_fit, <span class="at">type =</span> <span class="st">"martingale"</span>,    <span class="co"># martingale on y-axi</span></span>
<span id="cb20-3"><a></a>                 <span class="at">ox.scale =</span> <span class="st">"linear.predictions"</span>) <span class="co"># linear predictor on x-axis</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="sec4_files/figure-revealjs/unnamed-chunk-19-1.png" width="960" class="r-stretch"></section>
<section id="influential-points" class="slide level2">
<h2>Influential Points</h2>
<ul>
<li><strong>Deviance residuals</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="co"># Deviance residuals vs linear predictor</span></span>
<span id="cb21-2"><a></a><span class="fu">ggcoxdiagnostics</span>(cox_fit, <span class="at">type =</span> <span class="st">"deviance"</span>,  <span class="co"># deviance on y-axis</span></span>
<span id="cb21-3"><a></a>                 <span class="at">ox.scale =</span> <span class="st">"observation.id"</span>, <span class="co"># observation ID on x-axis</span></span>
<span id="cb21-4"><a></a>                 <span class="at">sline =</span> <span class="cn">FALSE</span>)               <span class="co"># no smoothed line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="sec4_files/figure-revealjs/unnamed-chunk-20-1.png" width="960" class="r-stretch"></section>
<section id="general-residual-graphics" class="slide level2">
<h2>General Residual Graphics</h2>
<ul>
<li><strong>Basic arguments of <code>ggcoxdiagnostics()</code></strong>
<ul>
<li><code>coxph</code> object</li>
<li><code>type</code>: Residual type (“martingale”, “deviance”, “score”, “schoenfeld”, “dfbeta”, “dfbetas”, and “scaledsch”)`</li>
<li><code>ox.scale</code>: Scale for x-axis (“linear.predictions”, “observation.id”, “time”)</li>
<li><code>point.col</code>: Color of points</li>
<li><code>point.size</code>: Size of points</li>
<li>etc.</li>
</ul></li>
<li>More about <code>survminer</code>
<ul>
<li><a href="https://rpkgs.datanovia.com/survminer/index.html">survminer</a> website</li>
</ul></li>
</ul>
</section></section>
<section id="competing-risks-regression" class="title-slide slide level1 center">
<h1>Competing Risks Regression</h1>

</section>

<section>
<section id="summary" class="title-slide slide level1 center">
<h1>Summary</h1>

</section>
<section id="key-takeaways" class="slide level2">
<h2>Key Takeaways</h2>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/lmaowisc\.github\.io\/tidysurv\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>