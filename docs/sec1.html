<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.39">

  <meta name="author" content="Lu Mao">
  <title>Tidy Survival Analysis --- A Workshop – Tidy Survival Analysis: Applying R’s Tidyverse to Survival Data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-423d414d36ce366a9d05f36d06304417.css">
  <link rel="stylesheet" href="style.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <style type="text/css">
  ul li ul li {
    font-size: 0.78em;
  }
  </style>
<meta name="twitter:title" content="Tidy Survival Analysis: Applying R’s Tidyverse to Survival Data – Tidy Survival Analysis — A Workshop">
<meta name="twitter:description" content="Module 1. Introduction">
<meta name="twitter:card" content="summary">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Tidy Survival Analysis: Applying R’s Tidyverse to Survival Data</h1>
  <p class="subtitle">Module 1. Introduction</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Lu Mao 
</div>
<div class="quarto-title-author-email">
<a href="mailto:lmao@biostat.wisc.edu">lmao@biostat.wisc.edu</a>
</div>
        <p class="quarto-title-affiliation">
            Department of Biostatistics &amp; Medical Informatics
          </p>
        <p class="quarto-title-affiliation">
            University of Wisconsin-Madison
          </p>
        <p class="quarto-title-affiliation">
            Aug 3, 2025
          </p>
    </div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/basics-of-survival-analysis" id="/toc-basics-of-survival-analysis">Basics of Survival Analysis</a></li>
<li><a href="#/german-breast-cancer-study-a-working-example" id="/toc-german-breast-cancer-study-a-working-example">German Breast Cancer Study: A Working Example</a></li>
<li><a href="#/standard-analysis-with-survival-package" id="/toc-standard-analysis-with-survival-package">Standard Analysis with <code>survival</code> Package</a></li>
<li><a href="#/summary" id="/toc-summary">Summary</a></li>
</ul>
</nav>
</section>
<section>
<section id="basics-of-survival-analysis" class="title-slide slide level1 center">
<h1>Basics of Survival Analysis</h1>

</section>
<section id="time-to-event-data" class="slide level2">
<h2>Time-to-Event Data</h2>
<ul>
<li>A common type of outcome in medical and clinical studies
<ul>
<li><strong>Starting point</strong>: Randomization, diagnosis, enrollment, birth, etc.<br>
</li>
<li><strong>Endpoint (Event of interest)</strong>: Death, disease onset, hospitalization, etc.
<ul>
<li><strong>Engineering</strong>: Failure times of machines or components (reliability)</li>
<li><strong>Social sciences</strong>: Time to job change, dropout, or event occurrence</li>
</ul></li>
</ul></li>
<li><strong>Right censoring</strong>:
<ul>
<li>Event not observed within the follow-up period</li>
<li>Due to study ending, dropout, or loss to follow-up</li>
<li>We only know:<br>
<span class="math display">\[
T &gt; C
\]</span> where <span class="math inline">\(T\)</span> is event time and <span class="math inline">\(C\)</span> is censoring time</li>
</ul></li>
</ul>
</section>
<section id="follow-up-swimmer-plot" class="slide level2">
<h2>Follow-up (Swimmer) Plot</h2>
<ul>
<li>A rat tumorigenicity study</li>
</ul>

<img data-src="images/rat_swim.png" class="quarto-figure quarto-figure-center r-stretch" style="width:60.0%"></section>
<section id="basic-estimands" class="slide level2">
<h2>Basic Estimands</h2>
<ul>
<li><strong>Survival function</strong>: <span class="math inline">\(S(t) = \Pr(T &gt; t)\)</span>
<ul>
<li>Probability subject survives beyond time <span class="math inline">\(t\)</span></li>
</ul></li>
<li><strong>Hazard function</strong>:<br>
<span class="math display">\[
\lambda(t) = \lim_{\Delta t \to 0} \frac{\Pr(t \leq T &lt; t + \Delta t \mid T \geq t)}{\Delta t}
\]</span>
<ul>
<li>Instantaneous risk of failure at time <span class="math inline">\(t\)</span></li>
</ul></li>
<li><strong>Relationship</strong> <span class="math display">\[
S(t) = \exp\left(-\int_0^t \lambda(u) \mathrm{d}u\right)
\]</span>
<ul>
<li><strong>Cumulative hazard function</strong>: <span class="math inline">\(\Lambda(t) = \int_0^t \lambda(u) \mathrm{d}u\)</span></li>
</ul></li>
</ul>
</section>
<section id="observed-censored-data" class="slide level2">
<h2>Observed (Censored) Data</h2>
<ul>
<li><strong>Notation</strong>: <span class="math inline">\((X, \delta)\)</span>
<ul>
<li><span class="math inline">\(X=\min(T, C)\)</span>: observation time (event or censoring)</li>
<li><span class="math inline">\(\delta = I(T\leq C)\)</span>: event indicator (1 for event, 0 for censoring)</li>
</ul></li>
<li><strong>Data format</strong></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="co"># time = X, status = delta (tidy format)</span></span>
<span id="cb1-2"><a></a>    id    time status</span>
<span id="cb1-3"><a></a><span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">5</span>     <span class="dv">1</span></span>
<span id="cb1-4"><a></a><span class="dv">2</span>     <span class="dv">2</span>     <span class="dv">3</span>     <span class="dv">0</span></span>
<span id="cb1-5"><a></a><span class="dv">3</span>     <span class="dv">3</span>     <span class="dv">8</span>     <span class="dv">1</span></span>
<span id="cb1-6"><a></a><span class="dv">4</span>     <span class="dv">4</span>     <span class="dv">2</span>     <span class="dv">0</span></span>
<span id="cb1-7"><a></a><span class="dv">5</span>     <span class="dv">5</span>     <span class="dv">6</span>     <span class="dv">1</span></span>
<span id="cb1-8"><a></a><span class="co"># Alternatively </span></span>
<span id="cb1-9"><a></a>    id    time </span>
<span id="cb1-10"><a></a><span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">5</span>   </span>
<span id="cb1-11"><a></a><span class="dv">2</span>     <span class="dv">2</span>     <span class="dv">3</span><span class="sc">+</span>  </span>
<span id="cb1-12"><a></a><span class="dv">3</span>     <span class="dv">3</span>     <span class="dv">8</span>  </span>
<span id="cb1-13"><a></a><span class="dv">4</span>     <span class="dv">4</span>     <span class="dv">2</span><span class="sc">+</span>  </span>
<span id="cb1-14"><a></a><span class="dv">5</span>     <span class="dv">5</span>     <span class="dv">6</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="german-breast-cancer-study-a-working-example" class="title-slide slide level1 center">
<h1>German Breast Cancer Study: A Working Example</h1>

</section>
<section id="german-breast-cancer-gbc-study" class="slide level2">
<h2>German Breast Cancer (GBC) Study</h2>
<ul>
<li><strong>Study Information</strong>
<ul>
<li><strong>Population</strong>: 686 patients with node-positive breast cancer<br>
</li>
<li><strong>Objective</strong>: Assess if tamoxifen + chemo reduces mortality/relapse<br>
</li>
<li><strong>Baseline info</strong>: Age, tumor size, hormone levels, menopausal status, etc.<br>
</li>
<li><strong>Follow-up</strong>: Median 44 months
<ul>
<li>171 deaths <span class="math inline">\(\to\)</span> exact times known<br>
</li>
<li>515 censored <span class="math inline">\(\to\)</span> survival time <span class="math inline">\(&gt;\)</span> censoring time</li>
</ul></li>
</ul></li>
<li><strong>Data sets</strong>:
<ul>
<li>Mortality data: <a href="https://lmaowisc.github.io/tidysurv/data/gbc_mort.txt" target="_blank">https://lmaowisc.github.io/tidysurv/data/gbc_mort.txt</a></li>
<li>Mortality + relapse: <a href="https://lmaowisc.github.io/tidysurv/data/gbc.txt" target="_blank">https://lmaowisc.github.io/tidysurv/data/gbc.txt</a></li>
<li>Download and save in a <code>data</code> folder under your root directory</li>
</ul></li>
</ul>
</section>
<section id="data-format-i" class="slide level2">
<h2>Data Format (I)</h2>
<ul>
<li><strong>Death only</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="co"># Load mortality data</span></span>
<span id="cb2-2"><a></a>gbc_mort <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/gbc_mort.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-3"><a></a><span class="co"># Check the first few rows of the data frame</span></span>
<span id="cb2-4"><a></a><span class="fu">head</span>(gbc_mort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id      time status hormone age meno size grade nodes prog estrg
1  1 74.819672      0       1  38    1   18     3     5  141   105
2  2 65.770492      0       1  52    1   20     1     1   78    14
3  3 47.737705      1       1  47    1   30     2     1  422    89
4  4  4.852459      0       1  40    1   24     1     3   25    11
5  5 61.081967      0       2  64    2   19     2     1   19     9
6  6 63.377049      0       2  49    2   56     1     3  356    64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="co"># The data frame 'gbc_mort' contains:</span></span>
<span id="cb4-2"><a></a><span class="co">#  time:   time (months) to death or censoring</span></span>
<span id="cb4-3"><a></a><span class="co">#  status: event indicator (1 = death, 0 = censoring)</span></span>
<span id="cb4-4"><a></a><span class="co"># hormone: Hormone therapy (1 = no, 2 = yes); age: Age at diagnosis (years);</span></span>
<span id="cb4-5"><a></a><span class="co"># meno: Menopausal status (1 = no, 2 = yes); size: Tumor size (mm); grade: Tumor grade (1–3);</span></span>
<span id="cb4-6"><a></a><span class="co"># nodes: Number of positive lymph nodes; prog: Progesterone receptor level (fmol/mg); estrg:</span></span>
<span id="cb4-7"><a></a><span class="co"># Estrogen receptor level (fmol/mg).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-format-ii" class="slide level2">
<h2>Data Format (II)</h2>
<ul>
<li><strong>Mortality + relapse</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="co"># Load mortality + relapse data</span></span>
<span id="cb5-2"><a></a>gbc <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/gbc.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a></a><span class="co"># Check the first few rows of the data frame</span></span>
<span id="cb5-4"><a></a><span class="fu">head</span>(gbc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id     time status hormone age meno size grade nodes prog estrg
1  1 43.83607      1       1  38    1   18     3     5  141   105
2  1 74.81967      0       1  38    1   18     3     5  141   105
3  2 46.55738      1       1  52    1   20     1     1   78    14
4  2 65.77049      0       1  52    1   20     1     1   78    14
5  3 41.93443      1       1  47    1   30     2     1  422    89
6  3 47.73770      2       1  47    1   30     2     1  422    89</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="co"># The data frame 'gbc' contains:</span></span>
<span id="cb7-2"><a></a><span class="co">#  time:   time (months) to death, relapse, or censoring</span></span>
<span id="cb7-3"><a></a><span class="co">#  status: event indicator (1 = relapse, 2 = death, 0 = censoring)</span></span>
<span id="cb7-4"><a></a><span class="co">#  other covariates the same as in gbc_mor.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analysis-goals" class="slide level2">
<h2>Analysis Goals</h2>
<ul>
<li><strong>Descriptive</strong>
<ul>
<li>Summarize patient characteristics</li>
<li>Visualize survival distributions</li>
</ul></li>
<li><strong>Inferential</strong>
<ul>
<li>Compare survival curves (e.g., hormone therapy vs.&nbsp;no hormone therapy)</li>
<li>Assess impact of covariates on survival (e.g., age, tumor size, etc.)</li>
<li>Model competing risks (e.g., relapse vs.&nbsp;death)</li>
</ul></li>
<li><strong>Predictive</strong>
<ul>
<li>Develop risk prediction models</li>
<li>Evaluate model performance (e.g., concordance index, calibration)</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="standard-analysis-with-survival-package" class="title-slide slide level1 center">
<h1>Standard Analysis with <code>survival</code> Package</h1>

</section>
<section id="survival-package-overview" class="slide level2">
<h2>Survival Package Overview</h2>
<ul>
<li><strong>Key Functions</strong>
<ul>
<li><code>Surv()</code>: Create survival object</li>
<li><code>survfit()</code>: Fit Kaplan-Meier survival curves</li>
<li><code>survdiff()</code>: Compare survival curves (log-rank test)</li>
<li><code>coxph()</code>: Fit Cox proportional hazards regression models</li>
<li><code>survreg()</code>: Fit parametric survival regression models</li>
</ul></li>
</ul>
</section>
<section id="kaplan-meier-survival-curves" class="slide level2">
<h2>Kaplan-Meier Survival Curves</h2>
<ul>
<li><strong>Create dataset for relapse-free survival</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="co"># Sort by subject id, then time</span></span>
<span id="cb8-2"><a></a>o <span class="ot">&lt;-</span> <span class="fu">order</span>(gbc<span class="sc">$</span>id, gbc<span class="sc">$</span>time)</span>
<span id="cb8-3"><a></a>gbc <span class="ot">&lt;-</span> gbc[o,]</span>
<span id="cb8-4"><a></a><span class="co"># Keep only first row per subject =&gt; first event</span></span>
<span id="cb8-5"><a></a>df <span class="ot">&lt;-</span> gbc[<span class="sc">!</span><span class="fu">duplicated</span>(gbc<span class="sc">$</span>id), ]</span>
<span id="cb8-6"><a></a><span class="co"># Convert status &gt; 0 to 1 if it is either relapse or death</span></span>
<span id="cb8-7"><a></a>df<span class="sc">$</span>status <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>status <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb8-8"><a></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id      time status hormone age meno size grade nodes prog estrg
1  1 43.836066      1       1  38    1   18     3     5  141   105
3  2 46.557377      1       1  52    1   20     1     1   78    14
5  3 41.934426      1       1  47    1   30     2     1  422    89
7  4  4.852459      0       1  40    1   24     1     3   25    11
8  5 61.081967      0       2  64    2   19     2     1   19     9
9  6 63.377049      0       2  49    2   56     1     3  356    64</code></pre>
</div>
</div>
</section>
<section id="kaplan-meier-curves-i" class="slide level2">
<h2>Kaplan-Meier Curves (I)</h2>
<ul>
<li><strong>Fit Kaplan-Meier survival curves</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">library</span>(survival) </span>
<span id="cb10-2"><a></a><span class="co"># Fit KM curves by hormone treatment group</span></span>
<span id="cb10-3"><a></a>km_fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> hormone, <span class="at">data =</span> df)</span>
<span id="cb10-4"><a></a>km_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ hormone, data = df)

            n events median 0.95LCL 0.95UCL
hormone=1 440    205   50.1    42.5    59.5
hormone=2 246     94   66.2    62.9      NA</code></pre>
</div>
</div>
</section>
<section id="kaplan-meier-curves-ii" class="slide level2">
<h2>Kaplan-Meier Curves (II)</h2>
<ul>
<li><p><strong>Summarize survival estimates at specified time points</strong></p>
<ul>
<li>For example, at 6, 12, 24, and 36 months</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">summary</span>(km_fit, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">36</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ hormone, data = df)

                hormone=1 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    6    419       9    0.979 0.00691        0.966        0.993
   12    379      35    0.897 0.01476        0.868        0.926
   24    280      73    0.720 0.02203        0.678        0.764
   36    195      41    0.606 0.02475        0.559        0.656

                hormone=2 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    6    236       4    0.983 0.00826        0.967        1.000
   12    223       8    0.950 0.01418        0.922        0.978
   24    177      38    0.785 0.02701        0.733        0.839
   36    136      16    0.708 0.03047        0.650        0.770</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="kaplan-meier-curves-iii" class="slide level2">
<h2>Kaplan-Meier Curves (III)</h2>
<ul>
<li><strong>Plot Kaplan-Meier survival curves by group</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="fu">plot</span>(km_fit, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">xlab =</span> <span class="st">"Time (months)"</span>, <span class="at">ylab =</span> <span class="st">"Relapse-free survival probability"</span>,</span>
<span id="cb14-2"><a></a>     <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-3"><a></a><span class="co"># Add legend</span></span>
<span id="cb14-4"><a></a><span class="fu">legend</span>(<span class="dv">1</span>, <span class="fl">0.2</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">lty =</span> <span class="dv">1</span>, </span>
<span id="cb14-5"><a></a>       <span class="fu">c</span>(<span class="st">"No hormone"</span>, <span class="st">"Hormone"</span>)) <span class="co"># Legend text</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="sec1_files/figure-revealjs/unnamed-chunk-6-1.png" width="960" class="r-stretch"></section>
<section id="log-rank-test" class="slide level2">
<h2>Log-Rank Test</h2>
<ul>
<li><strong>Compare survival curves between groups</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>lgr_obj <span class="ot">&lt;-</span> <span class="fu">survdiff</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> hormone, <span class="at">data =</span> df)</span>
<span id="cb15-2"><a></a>lgr_obj <span class="co"># Print log-rank test results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(time, status) ~ hormone, data = df)

            N Observed Expected (O-E)^2/E (O-E)^2/V
hormone=1 440      205      180      3.37      8.56
hormone=2 246       94      119      5.12      8.56

 Chisq= 8.6  on 1 degrees of freedom, p= 0.003 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>lgr_obj<span class="sc">$</span>pvalue <span class="co"># Extract p-value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.003427282</code></pre>
</div>
</div>
<div class="callout callout-note no-icon callout-titled callout-style-simple">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercise</strong></p>
</div>
<div class="callout-content">
<p>Perform a log-rank test on treatment stratified by patient menopausal status <code>meno</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> hormone <span class="sc">+</span> <span class="fu">strata</span>(meno), <span class="at">data =</span> df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="cox-model---model-specification" class="slide level2">
<h2>Cox Model - Model Specification</h2>
<ul>
<li><strong>Cox proportional hazards model</strong> <span class="math display">\[
\lambda(t \mid Z) = \lambda_0(t) \exp(\beta_1 Z_1 + \beta_2 Z_2 + \ldots + \beta_p Z_p)
\]</span>
<ul>
<li><span class="math inline">\(\lambda_0(t)\)</span>: baseline hazard function</li>
<li><span class="math inline">\(Z=(Z_1,\ldots, Z_p)^\mathrm{T}\)</span>: covariates (e.g., hormone therapy, age, tumor size)</li>
<li><span class="math inline">\(\beta=(\beta_1，\ldots，\beta_p)^\mathrm{T}\)</span>: regression coefficients</li>
<li><span class="math inline">\(\exp(\beta_j)\)</span>: hazard ratio for covariate <span class="math inline">\(Z_j\)</span></li>
</ul></li>
<li><strong>Proportional hazards (PH) assumption</strong> <span class="math display">\[
\frac{\lambda(t \mid Z)}{\lambda(t \mid Z^*)} = \exp\{\beta^\mathrm{T}(Z - Z^*)\}
\]</span>
<ul>
<li>HR constant over time, i.e., <span class="math inline">\(\beta(t) \equiv \beta\)</span> (for each covariate)</li>
</ul></li>
</ul>
</section>
<section id="cox-model---model-fitting-i" class="slide level2">
<h2>Cox Model - Model Fitting (I)</h2>
<ul>
<li><strong>Model fitting</strong>: <code>survival::coxph()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>cox_fit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> hormone <span class="sc">+</span> meno <span class="sc">+</span> age <span class="sc">+</span> grade <span class="sc">+</span> size <span class="sc">+</span> prog <span class="sc">+</span> estrg, </span>
<span id="cb20-2"><a></a>                 <span class="at">data =</span> df)</span>
<span id="cb20-3"><a></a><span class="fu">summary</span>(cox_fit) <span class="co"># Print model summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(time, status) ~ hormone + meno + age + grade + 
    size + prog + estrg, data = df)

  n= 686, number of events= 299 

              coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    
hormone -0.3422139  0.7101963  0.1290669 -2.651  0.00801 ** 
meno     0.2765637  1.3185909  0.1837781  1.505  0.13236    
age     -0.0087813  0.9912572  0.0093375 -0.940  0.34700    
grade    0.2785797  1.3212519  0.1051531  2.649  0.00807 ** 
size     0.0152793  1.0153966  0.0036877  4.143 3.42e-05 ***
prog    -0.0023307  0.9976720  0.0005803 -4.016 5.91e-05 ***
estrg    0.0001678  1.0001679  0.0004669  0.359  0.71923    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
hormone    0.7102     1.4081    0.5515    0.9146
meno       1.3186     0.7584    0.9198    1.8904
age        0.9913     1.0088    0.9733    1.0096
grade      1.3213     0.7569    1.0752    1.6236
size       1.0154     0.9848    1.0081    1.0228
prog       0.9977     1.0023    0.9965    0.9988
estrg      1.0002     0.9998    0.9993    1.0011

Concordance= 0.651  (se = 0.016 )
Likelihood ratio test= 68.4  on 7 df,   p=3e-12
Wald test            = 61.93  on 7 df,   p=6e-11
Score (logrank) test = 61.23  on 7 df,   p=9e-11</code></pre>
</div>
</div>
</section>
<section id="cox-model---model-fitting-ii" class="slide level2">
<h2>Cox Model - Model Fitting (II)</h2>
<ul>
<li>Extracting <span class="math inline">\(\hat\beta\)</span> and <span class="math inline">\(\hat{\mathrm{var}}(\hat\beta)\)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>beta <span class="ot">&lt;-</span> cox_fit<span class="sc">$</span>coefficients <span class="co"># Estimated coefficients</span></span>
<span id="cb22-2"><a></a>vbeta <span class="ot">&lt;-</span> <span class="fu">vcov</span>(cox_fit) <span class="co"># Estimated variance-covariance matrix</span></span>
<span id="cb22-3"><a></a><span class="co"># Extract regression table (as data frame)</span></span>
<span id="cb22-4"><a></a><span class="fu">coef</span>(<span class="fu">summary</span>(cox_fit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 coef exp(coef)     se(coef)          z     Pr(&gt;|z|)
hormone -0.3422138547 0.7101963 0.1290669350 -2.6514448 8.014821e-03
meno     0.2765636858 1.3185909 0.1837780595  1.5048787 1.323553e-01
age     -0.0087812621 0.9912572 0.0093375120 -0.9404285 3.469978e-01
grade    0.2785796730 1.3212519 0.1051531448  2.6492757 8.066449e-03
size     0.0152793172 1.0153966 0.0036877471  4.1432660 3.423945e-05
prog    -0.0023307288 0.9976720 0.0005803186 -4.0162919 5.912102e-05
estrg    0.0001678465 1.0001679 0.0004669057  0.3594870 7.192308e-01</code></pre>
</div>
</div>
<ul>
<li><strong>Conclusion</strong>
<ul>
<li>Hormone therapy significantly reduces the risk of relapse or death by <span class="math inline">\(1-0.710=29\%\)</span> (<span class="math inline">\(p\)</span> = 0.008)</li>
</ul></li>
</ul>
</section>
<section id="cox-model---prediction-i" class="slide level2">
<h2>Cox Model - Prediction (I)</h2>
<ul>
<li><p><strong>Predicted survival function</strong> <span class="math display">\[
\hat S(t \mid z) = \exp\left\{- \exp(\hat\beta^\mathrm{T} z) \hat\Lambda_0(t)\right\}
\]</span></p></li>
<li><p>Prepare new data for prediction</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="co"># Create new data for prediction</span></span>
<span id="cb24-2"><a></a><span class="co"># specify all covariate values</span></span>
<span id="cb24-3"><a></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">hormone =</span> <span class="dv">1</span>, <span class="at">meno =</span> <span class="dv">1</span>, </span>
<span id="cb24-4"><a></a>                        <span class="at">age =</span> <span class="dv">45</span>, <span class="at">grade =</span> <span class="dv">2</span>, </span>
<span id="cb24-5"><a></a>                        <span class="at">size =</span> <span class="dv">20</span>, <span class="at">prog =</span> <span class="dv">100</span>, </span>
<span id="cb24-6"><a></a>                        <span class="at">estrg =</span> <span class="dv">100</span>)</span>
<span id="cb24-7"><a></a>new_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  hormone meno age grade size prog estrg
1       1    1  45     2   20  100   100</code></pre>
</div>
</div>
</section>
<section id="cox-model---prediction-ii" class="slide level2">
<h2>Cox Model - Prediction (II)</h2>
<ul>
<li><strong>Predict survival probabilities at specified time points</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="co"># Predict survival probabilities at 6, 12, 24, 26 months</span></span>
<span id="cb26-2"><a></a>predicted_survival <span class="ot">&lt;-</span> <span class="fu">survfit</span>(cox_fit, <span class="at">newdata =</span> new_data[<span class="dv">1</span>, ], <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">36</span>))</span>
<span id="cb26-3"><a></a><span class="fu">summary</span>(predicted_survival, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">36</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = cox_fit, newdata = new_data[1, ], times = c(6, 
    12, 24, 36))

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    6    655      13    0.985 0.00441        0.976        0.994
   12    602      43    0.933 0.01059        0.913        0.954
   24    457     111    0.786 0.02304        0.743        0.833
   36    331      57    0.696 0.02925        0.641        0.755</code></pre>
</div>
</div>
</section>
<section id="cox-model---prediction-iii" class="slide level2">
<h2>Cox Model - Prediction (III)</h2>
<ul>
<li><strong>Plot predicted survival function</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="co"># Plot predicted survival function</span></span>
<span id="cb28-2"><a></a><span class="fu">plot</span>(predicted_survival, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">xlab =</span> <span class="st">"Time (months)"</span>, </span>
<span id="cb28-3"><a></a>     <span class="at">ylab =</span> <span class="st">"Relapsep-free survival probability"</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="sec1_files/figure-revealjs/unnamed-chunk-13-1.png" width="960" class="r-stretch"></section>
<section id="cox-model---check-ph-assumptions-i" class="slide level2">
<h2>Cox Model - Check PH Assumptions (I)</h2>
<ul>
<li><strong>Schoenfeld residuals</strong>
<ul>
<li>Difference between observed and expected covariate values at each event time</li>
<li>Use <code>cox.zph()</code> to test PH assumption</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a>ph_test <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(cox_fit)</span>
<span id="cb29-2"><a></a>ph_test <span class="co"># Print test results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         chisq df      p
hormone  0.272  1 0.6017
meno     5.514  1 0.0189
age      9.430  1 0.0021
grade    8.490  1 0.0036
size     0.872  1 0.3505
prog     4.881  1 0.0272
estrg    5.403  1 0.0201
GLOBAL  20.636  7 0.0043</code></pre>
</div>
</div>
</section>
<section id="cox-model---check-ph-assumptions-ii" class="slide level2">
<h2>Cox Model - Check PH Assumptions (II)</h2>
<ul>
<li><strong>Graphical check of PH assumptions</strong>
<ul>
<li>Plot Schoenfeld residuals against time</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="fu">par</span>(<span class="at">mfrow=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)) <span class="co"># Set up 2x4 plotting area for 7 covariates</span></span>
<span id="cb31-2"><a></a><span class="fu">plot</span>(ph_test, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># Plot Schoenfeld residuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="sec1_files/figure-revealjs/unnamed-chunk-15-1.png" width="960" class="r-stretch"></section>
<section id="cox-model---check-covariate-forms" class="slide level2">
<h2>Cox Model - Check Covariate Forms</h2>
<ul>
<li><p><strong>Check linearity of covariate effects</strong></p>
<ul>
<li>Plot martingale residuals against (quantitative) covariates</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a><span class="co"># Extract martingale residuals </span></span>
<span id="cb32-2"><a></a>mart_resid <span class="ot">&lt;-</span> <span class="fu">residuals</span>(cox_fit, <span class="at">type =</span> <span class="st">'martingale'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Plotting</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a><span class="fu">par</span>(<span class="at">mfrow=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>))  <span class="co"># Set up 1x4 plotting area for 4 covariates</span></span>
<span id="cb33-2"><a></a><span class="co"># Plot martingale residuals against age</span></span>
<span id="cb33-3"><a></a><span class="fu">plot</span>(df<span class="sc">$</span>age, mart_resid, <span class="at">xlab =</span> <span class="st">"Age"</span>, <span class="at">ylab =</span> <span class="st">"Martingale Residuals"</span>,</span>
<span id="cb33-4"><a></a>     <span class="at">main =</span> <span class="st">"Age"</span>)</span>
<span id="cb33-5"><a></a><span class="co"># Add smoothed line</span></span>
<span id="cb33-6"><a></a><span class="fu">lines</span>(<span class="fu">lowess</span>(df<span class="sc">$</span>age, mart_resid), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb33-7"><a></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># Add horizontal line at 0</span></span>
<span id="cb33-8"><a></a></span>
<span id="cb33-9"><a></a><span class="co"># Repeat for other covariates</span></span>
<span id="cb33-10"><a></a><span class="fu">plot</span>(df<span class="sc">$</span>size, mart_resid, <span class="at">xlab =</span> <span class="st">"Tumor Size"</span>, <span class="at">ylab =</span> <span class="st">"Martingale Residuals"</span>,</span>
<span id="cb33-11"><a></a>     <span class="at">main =</span> <span class="st">"Tumor Size"</span>)</span>
<span id="cb33-12"><a></a><span class="fu">lines</span>(<span class="fu">lowess</span>(df<span class="sc">$</span>size, mart_resid), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb33-13"><a></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># Add horizontal line at 0</span></span>
<span id="cb33-14"><a></a><span class="fu">plot</span>(df<span class="sc">$</span>prog, mart_resid, <span class="at">xlab =</span> <span class="st">"Progesterone Receptor"</span>, <span class="at">ylab =</span> <span class="st">"Martingale Residuals"</span>,</span>
<span id="cb33-15"><a></a>     <span class="at">main =</span> <span class="st">"Progesterone Receptor"</span>)</span>
<span id="cb33-16"><a></a><span class="fu">lines</span>(<span class="fu">lowess</span>(df<span class="sc">$</span>prog, mart_resid), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb33-17"><a></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># Add horizontal line at 0</span></span>
<span id="cb33-18"><a></a><span class="fu">plot</span>(df<span class="sc">$</span>estrg, mart_resid, <span class="at">xlab =</span> <span class="st">"Estrogen Receptor"</span>, <span class="at">ylab =</span> <span class="st">"Martingale Residuals"</span>,</span>
<span id="cb33-19"><a></a>     <span class="at">main =</span> <span class="st">"Estrogen Receptor"</span>)</span>
<span id="cb33-20"><a></a><span class="fu">lines</span>(<span class="fu">lowess</span>(df<span class="sc">$</span>estrg, mart_resid), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb33-21"><a></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># Add horizontal line at 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="sec1_files/figure-revealjs/unnamed-chunk-17-1.png" width="1536"></p>
</figure>
</div>
</div>
</div></li>
</ul>
</section>
<section id="coding-exercise" class="slide level2">
<h2>Coding Exercise</h2>
<div class="callout callout-note no-icon callout-titled callout-style-simple">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercise</strong></p>
</div>
<div class="callout-content">
<p>Residual analyses show that the proportional hazards assumption is violated for tumor grade, and that the effect of age is not linear.</p>
<p>Fit a different model to address these issues.</p>
<div class="cell">
<details class="code-fold">
<summary>Sample solution</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a><span class="co"># Dichotomize age at 40</span></span>
<span id="cb34-2"><a></a>df<span class="sc">$</span>age40 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>age <span class="sc">&lt;</span> <span class="dv">40</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb34-3"><a></a><span class="co"># Fit Cox model stratified by tumor grade and with binary age </span></span>
<span id="cb34-4"><a></a>cox_fit2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> hormone <span class="sc">+</span> meno <span class="sc">+</span> age40 <span class="sc">+</span> size <span class="sc">+</span> prog <span class="sc">+</span> estrg <span class="sc">+</span> </span>
<span id="cb34-5"><a></a>                   <span class="fu">strata</span>(grade), <span class="at">data =</span> df)</span>
<span id="cb34-6"><a></a><span class="fu">summary</span>(cox_fit2) <span class="co"># Print model summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="summary" class="title-slide slide level1 center">
<h1>Summary</h1>

</section>
<section id="key-takeaways" class="slide level2">
<h2>Key Takeaways</h2>
<ul>
<li>Survival analysis is essential for (often censored) time-to-event data</li>
<li>Key estimands: survival function, hazard function, cumulative hazard</li>
<li>Standard analysis tools
<ul>
<li>Kaplan-Meier curves (<code>survfit()</code>)</li>
<li>Log-rank test (<code>survdiff()</code>)</li>
<li>Cox proportional hazards model (<code>coxph()</code>)</li>
</ul></li>
</ul>
</section>
<section id="open-questions" class="slide level2">
<h2>Open Questions</h2>
<ul>
<li>Efficient/effective presentation of survival probabilities
<ul>
<li>Point estimates, confidence intervals</li>
</ul></li>
<li>Customizable survival curves
<ul>
<li>Add at risk table below graph</li>
</ul></li>
<li>Presentation of regression results
<ul>
<li>Hazard ratios, confidence intervals, p-values</li>
<li>Visualize regression results (e.g., forest plots)</li>
</ul></li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/lmaowisc\.github\.io\/tidysurv\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>